{"version":3,"sources":["getGroupStyles.ts"],"names":["getGroupStyles","params","dateSeparators","hideDateSeparators","maxTimeBetweenGroupedMessages","messages","noGroupByUser","userId","messageGroupStyles","messagesFilteredForNonUser","filter","message","deleted_at","user","id","i","length","previousMessage","nextMessage","groupStyles","isTopMessage","type","includes","isBottomMessage","undefined","created_at","getTime","push","splice"],"mappings":"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","sourcesContent":["import type { DateSeparators } from './getDateSeparators';\n\nimport type { GroupType } from '../hooks/useMessageList';\n\nimport type { PaginatedMessageListContextValue } from '../../../contexts/paginatedMessageListContext/PaginatedMessageListContext';\nimport type { ThreadContextValue } from '../../../contexts/threadContext/ThreadContext';\nimport type {\n  DefaultAttachmentType,\n  DefaultChannelType,\n  DefaultCommandType,\n  DefaultEventType,\n  DefaultMessageType,\n  DefaultReactionType,\n  DefaultUserType,\n  UnknownType,\n} from '../../../types/types';\n\nexport type GetGroupStylesParams<\n  At extends UnknownType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType,\n> = {\n  dateSeparators: DateSeparators;\n  messages:\n    | PaginatedMessageListContextValue<At, Ch, Co, Ev, Me, Re, Us>['messages']\n    | ThreadContextValue<At, Ch, Co, Ev, Me, Re, Us>['threadMessages'];\n  hideDateSeparators?: boolean;\n  maxTimeBetweenGroupedMessages?: number;\n  noGroupByUser?: boolean;\n  userId?: string;\n};\n\nexport const getGroupStyles = <\n  At extends UnknownType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType,\n>(\n  params: GetGroupStylesParams<At, Ch, Co, Ev, Me, Re, Us>,\n) => {\n  const {\n    dateSeparators,\n    hideDateSeparators,\n    maxTimeBetweenGroupedMessages,\n    messages,\n    noGroupByUser,\n    userId,\n  } = params;\n\n  if (noGroupByUser) return {};\n\n  const messageGroupStyles: { [key: string]: GroupType[] } = {};\n\n  const messagesFilteredForNonUser = messages.filter(\n    (message) => !message.deleted_at || userId === message.user?.id,\n  );\n\n  for (let i = 0; i < messagesFilteredForNonUser.length; i++) {\n    const previousMessage = messagesFilteredForNonUser[i - 1] as\n      | typeof messagesFilteredForNonUser[0]\n      | undefined;\n    const message = messagesFilteredForNonUser[i];\n    const nextMessage = messagesFilteredForNonUser[i + 1] as\n      | typeof messagesFilteredForNonUser[0]\n      | undefined;\n    const groupStyles: GroupType[] = [];\n\n    const userId = message?.user?.id || null;\n\n    const isTopMessage =\n      !previousMessage ||\n      previousMessage.type === 'system' ||\n      userId !== previousMessage?.user?.id ||\n      previousMessage.type === 'error' ||\n      !!previousMessage.deleted_at ||\n      (!hideDateSeparators && dateSeparators[message.id]) ||\n      messageGroupStyles[previousMessage.id]?.includes('bottom');\n\n    const isBottomMessage =\n      !nextMessage ||\n      nextMessage.type === 'system' ||\n      userId !== nextMessage?.user?.id ||\n      nextMessage.type === 'error' ||\n      !!nextMessage.deleted_at ||\n      (!hideDateSeparators && dateSeparators[nextMessage.id]) ||\n      (maxTimeBetweenGroupedMessages !== undefined &&\n        nextMessage.created_at.getTime() - message.created_at.getTime() >\n          maxTimeBetweenGroupedMessages);\n\n    /**\n     * Add group styles key for top message\n     */\n    if (isTopMessage) {\n      groupStyles.push('top');\n    }\n\n    /**\n     * Add group styles key for bottom message\n     */\n    if (isBottomMessage) {\n      /**\n       * If the bottom message is also the top, or deleted, or an error,\n       * add the key for single message instead of bottom\n       */\n      if (isTopMessage || message.deleted_at || message.type === 'error') {\n        groupStyles.splice(0, groupStyles.length);\n        groupStyles.push('single');\n      } else {\n        groupStyles.push('bottom');\n      }\n    }\n\n    /**\n     * Add the key for all non top or bottom messages, if the message is\n     * deleted or an error add the key for single otherwise middle\n     */\n    if (!isTopMessage && !isBottomMessage) {\n      if (message.deleted_at || message.type === 'error') {\n        groupStyles.splice(0, groupStyles.length);\n        groupStyles.push('single');\n      } else {\n        groupStyles.splice(0, groupStyles.length);\n        groupStyles.push('middle');\n      }\n    }\n\n    if (message.id) {\n      messageGroupStyles[message.id] = groupStyles;\n    }\n  }\n\n  return messageGroupStyles;\n};\n"]}