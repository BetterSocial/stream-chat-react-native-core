{"version":3,"sources":["getDateSeparators.ts"],"names":["getDateSeparators","params","hideDateSeparators","messages","userId","dateSeparators","messagesWithoutDeleted","filter","message","deleted_at","user","id","i","length","previousMessage","messageDate","created_at","getDay","prevMessageDate"],"mappings":";;;;;AAiCO,IAAMA,iBAAiB,GAAG,SAApBA,iBAAoB,CAS/BC,MAT+B,EAU5B;AACH,MAAQC,kBAAR,GAAiDD,MAAjD,CAAQC,kBAAR;AAAA,MAA4BC,QAA5B,GAAiDF,MAAjD,CAA4BE,QAA5B;AAAA,MAAsCC,MAAtC,GAAiDH,MAAjD,CAAsCG,MAAtC;AACA,MAAMC,cAA8B,GAAG,EAAvC;;AAEA,MAAIH,kBAAJ,EAAwB;AACtB,WAAOG,cAAP;AACD;;AAED,MAAMC,sBAAsB,GAAGH,QAAQ,CAACI,MAAT,CAC7B,UAACC,OAAD;AAAA;;AAAA,WAAa,CAACA,OAAO,CAACC,UAAT,IAAuBL,MAAM,uBAAKI,OAAO,CAACE,IAAb,qBAAK,cAAcC,EAAnB,CAA1C;AAAA,GAD6B,CAA/B;;AAIA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,sBAAsB,CAACO,MAA3C,EAAmDD,CAAC,EAApD,EAAwD;AACtD,QAAME,eAAe,GAAGR,sBAAsB,CAACM,CAAC,GAAG,CAAL,CAA9C;AACA,QAAMJ,OAAO,GAAGF,sBAAsB,CAACM,CAAD,CAAtC;AAEA,QAAMG,WAAW,GAAGP,OAAO,CAACQ,UAAR,CAAmBC,MAAnB,EAApB;AAEA,QAAMC,eAAe,GAAGJ,eAAe,GAAGA,eAAe,CAACE,UAAhB,CAA2BC,MAA3B,EAAH,GAAyCF,WAAhF;;AAEA,QAAIH,CAAC,KAAK,CAAN,IAAWG,WAAW,KAAKG,eAA/B,EAAgD;AAC9Cb,MAAAA,cAAc,CAACG,OAAO,CAACG,EAAT,CAAd,GAA6BH,OAAO,CAACQ,UAArC;AACD;AACF;;AAED,SAAOX,cAAP;AACD,CApCM","sourcesContent":["import type { PaginatedMessageListContextValue } from '../../../contexts/paginatedMessageListContext/PaginatedMessageListContext';\nimport type { ThreadContextValue } from '../../../contexts/threadContext/ThreadContext';\nimport type {\n  DefaultAttachmentType,\n  DefaultChannelType,\n  DefaultCommandType,\n  DefaultEventType,\n  DefaultMessageType,\n  DefaultReactionType,\n  DefaultUserType,\n  UnknownType,\n} from '../../../types/types';\n\nexport type GetDateSeparatorsParams<\n  At extends UnknownType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType,\n> = {\n  messages:\n    | PaginatedMessageListContextValue<At, Ch, Co, Ev, Me, Re, Us>['messages']\n    | ThreadContextValue<At, Ch, Co, Ev, Me, Re, Us>['threadMessages'];\n  hideDateSeparators?: boolean;\n  userId?: string;\n};\n\nexport type DateSeparators = {\n  [key: string]: Date;\n};\n\nexport const getDateSeparators = <\n  At extends UnknownType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType,\n>(\n  params: GetDateSeparatorsParams<At, Ch, Co, Ev, Me, Re, Us>,\n) => {\n  const { hideDateSeparators, messages, userId } = params;\n  const dateSeparators: DateSeparators = {};\n\n  if (hideDateSeparators) {\n    return dateSeparators;\n  }\n\n  const messagesWithoutDeleted = messages.filter(\n    (message) => !message.deleted_at || userId === message.user?.id,\n  );\n\n  for (let i = 0; i < messagesWithoutDeleted.length; i++) {\n    const previousMessage = messagesWithoutDeleted[i - 1];\n    const message = messagesWithoutDeleted[i];\n\n    const messageDate = message.created_at.getDay();\n\n    const prevMessageDate = previousMessage ? previousMessage.created_at.getDay() : messageDate;\n\n    if (i === 0 || messageDate !== prevMessageDate) {\n      dateSeparators[message.id] = message.created_at;\n    }\n  }\n\n  return dateSeparators;\n};\n"]}